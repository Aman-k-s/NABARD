<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Farmer Voice Assistant (Fixed Language)</title>
</head>
<body>
  <h2>🌾 Farmer Voice Assistant</h2>
  <p>Select language:</p>
  <button onclick="setLang('en-IN')">🇬🇧 English</button>
  <button onclick="setLang('hi-IN')">🇮🇳 Hindi</button>

  <p id="question">Click Start after choosing language.</p>
  <button id="startBtn">🎤 Start</button>
  <p id="output">Transcript: —</p>

  <script>
    let currentLang = null;
    const questions_en = [
      "Which crop are you growing?",
      "Which fertilizer did you use?",
      "How many days did you keep water in the field?"
    ];
    const questions_hi = [
      "आप कौन सी फसल उगा रहे हैं?",
      "आपने कौन सा उर्वरक इस्तेमाल किया?",
      "आपने खेत में कितने दिन पानी रखा?"
    ];
    let currentQ = 0;
    let answers = {};

    const qDiv = document.getElementById("question");
    const oDiv = document.getElementById("output");
    const startBtn = document.getElementById("startBtn");

    function setLang(lang){
      currentLang = lang;
      qDiv.textContent = "Language set to " + (lang==="en-IN"?"English":"Hindi");
    }

    async function askQuestion(){
      if(!currentLang){ alert("Please select a language first!"); return; }
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      const rec = new SpeechRecognition();
      rec.lang = currentLang;
      rec.interimResults = false;
      rec.onresult = e => {
        const text = e.results[0][0].transcript.trim();
        oDiv.textContent = "Transcript: " + text;
        answers["Q"+(currentQ+1)] = text;
        currentQ++;
        if(currentQ < 3){
          qDiv.textContent = (currentLang==="en-IN"?questions_en:questions_hi)[currentQ];
          askQuestion();
        } else {
          qDiv.textContent = "✅ Done. Answers: " + JSON.stringify(answers);
        }
      };
      rec.start();
    }

    startBtn.addEventListener("click", ()=>{
      currentQ = 0; answers={};
      qDiv.textContent = (currentLang==="en-IN"?questions_en:questions_hi)[currentQ];
      askQuestion();
    });
  </script>
</body>
</html>
